{"version":3,"file":"script.js","sources":["src/index.js"],"sourcesContent":["import { Type, Dom, Event } from 'main.core';\n\nexport type SystemAuthAuthorizeParamsType = {\n\tauthContainerNode: HTMLElement,\n\tisQrAvailable: 'Y'|'N',\n\tqrText: string,\n\tqrConfig: string,\n}\n\nexport class SystemAuthAuthorize\n{\n\t#authContainerNode: HTMLElement;\n\t#isQrAvailable: boolean;\n\t#qrText: string;\n\t#qrConfig: string;\n\n\tconstructor(params: SystemAuthAuthorizeParamsType)\n\t{\n\t\tthis.#authContainerNode = params.authContainerNode;\n\t\tthis.#isQrAvailable = params.isQrAvailable === 'Y';\n\t\tthis.#qrText = params.qrText || '';\n\t\tthis.#qrConfig = params.qrConfig || '';\n\n\t\tif (!Type.isDomNode(this.#authContainerNode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.buttonNode = this.#authContainerNode.querySelector(\"[data-role='auth-form-button']\");\n\n\t\tthis.init();\n\n\t\tif (this.#isQrAvailable)\n\t\t{\n\t\t\tthis.initQrCode();\n\t\t}\n\t}\n\n\tinit(): void\n\t{\n\t\tBX.UI.Hint.init(this.#authContainerNode);\n\n\t\tif (Type.isDomNode(this.buttonNode))\n\t\t{\n\t\t\tEvent.bind(this.buttonNode, 'click', () => {\n\t\t\t\tconst spinnerNode = this.buttonNode.querySelector('.intranet-text-btn__spinner');\n\n\t\t\t\tif (Type.isDomNode(spinnerNode))\n\t\t\t\t{\n\t\t\t\t\tDom.style(spinnerNode, 'display', 'block');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tinitQrCode(): void\n\t{\n\t\tnew QRCode('bx_auth_qr_code', {\n\t\t\ttext: this.#qrText,\n\t\t\twidth: 220,\n\t\t\theight: 220,\n\t\t\tcolorDark: '#000000',\n\t\t\tcolorLight: '#ffffff',\n\t\t});\n\n\t\tif (!this.#qrConfig)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.qrCodeSuccessIcon = this.#authContainerNode.querySelector('.b24net-qr-scan-form__code-overlay');\n\n\t\tconst Pull = new BX.PullClient();\n\t\tPull.subscribe({\n\t\t\tmoduleId: 'main',\n\t\t\tcommand: 'qrAuthorize',\n\t\t\tcallback: (params) => {\n\t\t\t\tif (params.token)\n\t\t\t\t{\n\t\t\t\t\tthis.showQrCodeSuccessIcon();\n\n\t\t\t\t\tBX.ajax.runAction(\n\t\t\t\t\t\t'main.qrcodeauth.authenticate',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\ttoken: params.token,\n\t\t\t\t\t\t\t\tremember: (BX('USER_REMEMBER_QR') && BX('USER_REMEMBER_QR').checked ? 1 : 0),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t).then(\n\t\t\t\t\t\t(response) => {\n\t\t\t\t\t\t\tthis.hideQrCodeSuccessIcon();\n\n\t\t\t\t\t\t\tif (response.status === 'success')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\twindow.location = (params.redirectUrl !== '' ? params.redirectUrl : window.location);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tPull.start(this.#qrConfig);\n\t}\n\n\tshowQrCodeSuccessIcon(): void\n\t{\n\t\tif (!Type.isDomNode(this.qrCodeSuccessIcon))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.addClass(this.qrCodeSuccessIcon, 'b24net-qr-scan-form__code-overlay--active');\n\t}\n\n\thideQrCodeSuccessIcon(): void\n\t{\n\t\tif (!Type.isDomNode(this.qrCodeSuccessIcon))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.removeClass(this.qrCodeSuccessIcon, 'b24net-qr-scan-form__code-overlay--active');\n\t}\n}\n"],"names":["SystemAuthAuthorize","params","authContainerNode","isQrAvailable","qrText","qrConfig","Type","isDomNode","buttonNode","querySelector","init","initQrCode","BX","UI","Hint","Event","bind","spinnerNode","Dom","style","QRCode","text","width","height","colorDark","colorLight","qrCodeSuccessIcon","Pull","PullClient","subscribe","moduleId","command","callback","token","showQrCodeSuccessIcon","ajax","runAction","data","remember","checked","then","response","hideQrCodeSuccessIcon","status","window","location","redirectUrl","start","addClass","removeClass"],"mappings":"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"}