{"version":3,"file":"script.js","sources":["src/index.js"],"sourcesContent":["import { Dom, ajax as Ajax, Event, Tag, Loc, Runtime, Type } from 'main.core';\nimport { Loader } from 'main.loader';\nimport { EventEmitter, type BaseEvent } from 'main.core.events';\n\nexport type ImportantMessagesWidgetOptions = {\n\twidgetContainerId: string;\n\tmessages: ImportantMessagesWidgetMessage[];\n\toptions: Object;\n\tpostInfo: Object;\n\turl: string;\n\tpageSettings: ImportantMessagesWidgetPageSettings;\n}\n\ntype ImportantMessagesWidgetPageSettings = {\n\tNavPageCount: number;\n\tNavPageNomer: number;\n\tNavPageSize: number;\n\tNavRecordCount: number;\n\tbDescPageNumbering: boolean;\n\tnPageSize: number;\n\tiNumPage?: number;\n}\n\nexport type ImportantMessagesWidgetMessage = {\n\tid: string;\n\tauthor_avatar: string;\n\tauthor_url: string;\n\tauthor_name: string;\n\tpost_url: string;\n\tpost_text: string;\n}\n\ntype FetchNewMessagesResponse = {\n\tpageSettings: ImportantMessagesWidgetPageSettings;\n\tmessages: ImportantMessagesWidgetMessage[];\n}\n\nexport class ImportantMessagesWidget\n{\n\t#widgetContainerId: string;\n\t#messages: ImportantMessagesWidgetMessage[] = [];\n\t#options = {};\n\t#postInfo = {};\n\t#url: string = '';\n\t#pageSettings: ImportantMessagesWidgetPageSettings = {};\n\t#activeMessageIndex = 0;\n\t#loader: Loader;\n\t#loaderOverlay: HTMLElement;\n\t#lockButtons: boolean = false;\n\n\tconstructor(options: ImportantMessagesWidgetOptions)\n\t{\n\t\tthis.#widgetContainerId = options.widgetContainerId;\n\t\tthis.#messages = options.messages;\n\t\tthis.#options = options.options;\n\t\tthis.#postInfo = options.postInfo;\n\t\tthis.#url = options.url;\n\t\tthis.#pageSettings = options.pageSettings;\n\n\t\tthis.#postInfo.AJAX_POST = 'Y';\n\n\t\tthis.init();\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.#renderMessages();\n\n\t\tEvent.bind(this.#getNextMessageButton(), 'click', () => {\n\t\t\tif (this.#lockButtons)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#lockButtons = true;\n\n\t\t\tthis.#handleClickOnNextBtn()\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.#lockButtons = false;\n\t\t\t\t\tthis.updateNavigation();\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.#lockButtons = false;\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\n\t\tEvent.bind(this.#getPrevMessageButton(), 'click', () => {\n\t\t\tif (this.#lockButtons)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#lockButtons = true;\n\n\t\t\tthis.#showPrevMessage()\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.#lockButtons = false;\n\t\t\t\t\tthis.updateNavigation();\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.#lockButtons = false;\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\n\t\tEvent.bind(this.#getReadMessageButton(), 'click', () => {\n\t\t\tconst activeMessage = this.getActiveMessage();\n\t\t\tthis.#readMessage(activeMessage.id);\n\t\t});\n\n\t\tEventEmitter.subscribe('onImportantPostRead', (event) => {\n\t\t\tconst [messageId] = event.getData();\n\t\t\tthis.#removeMessageFromList(messageId);\n\t\t});\n\n\t\tconst loadNewMessages = Runtime.debounce(() => {\n\t\t\tthis.#loadNewMessages()\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.updateNavigation();\n\t\t\t\t\tthis.show();\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\t// fail silently\n\t\t\t\t})\n\t\t\t;\n\t\t}, 6000);\n\n\t\tEventEmitter.subscribe('onPullEvent-main', (event: BaseEvent) => {\n\t\t\tif (this.#messages.length > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst [command, params] = event.getCompatData();\n\t\t\tif (\n\t\t\t\tcommand === 'user_counter'\n\t\t\t\t&& params[Loc.getMessage('SITE_ID')]\n\t\t\t\t&& params[Loc.getMessage('SITE_ID')]['BLOG_POST_IMPORTANT']\n\t\t\t)\n\t\t\t{\n\t\t\t\tloadNewMessages();\n\t\t\t}\n\t\t});\n\n\t\tthis.updateNavigation();\n\t}\n\n\tshow(): void\n\t{\n\t\tif (this.#messages.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst activeMessage = this.getActiveMessage();\n\t\tif (!activeMessage)\n\t\t{\n\t\t\tconst message = this.#messages[this.#activeMessageIndex] || null;\n\t\t\tconst element = this.#getMessagesListContainer().querySelector(`[data-message-id=\"${message?.id}\"]`);\n\t\t\tif (element)\n\t\t\t{\n\t\t\t\tDom.addClass(element, '--active');\n\t\t\t}\n\t\t}\n\n\t\tDom.removeClass(this.#getWidgetContainer(), ['--hidden', '--hiding']);\n\t}\n\n\thide(): void\n\t{\n\t\tDom.addClass(this.#getWidgetContainer(), '--hiding');\n\t\tEvent.bindOnce(this.#getWidgetContainer(), 'transitionend', () => {\n\t\t\tDom.removeClass(this.#getWidgetContainer(), '--hiding');\n\t\t\tDom.addClass(this.#getWidgetContainer(), '--hidden');\n\t\t});\n\t}\n\n\t#needLoadNewMessages(): boolean\n\t{\n\t\treturn (\n\t\t\t(this.#pageSettings.bDescPageNumbering === true && this.#pageSettings.NavPageNomer > 1)\n\t\t\t|| this.#messages.length < this.#pageSettings.NavRecordCount\n\t\t);\n\t}\n\n\tasync #loadNewMessages(): Promise\n\t{\n\t\tconst data = await this.#fetchNewMessages();\n\t\tconst messages = data.messages;\n\n\t\tthis.#setPageSettings(data.pageSettings);\n\n\t\tfor (const message of messages)\n\t\t{\n\t\t\tif (this.#getMessageById(message.id))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.#messages.push(message);\n\n\t\t\tDom.append(\n\t\t\t\tthis.#renderMessageElement(message, false),\n\t\t\t\tthis.#getMessagesListContainer(),\n\t\t\t);\n\t\t}\n\t}\n\n\t#fetchNewMessages(): Promise<FetchNewMessagesResponse>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst request = this.#postInfo;\n\t\t\tif (this.#pageSettings.bDescPageNumbering)\n\t\t\t{\n\t\t\t\tthis.#pageSettings.iNumPage = this.#pageSettings.NavPageNomer - 1;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#pageSettings.iNumPage = this.#pageSettings.NavPageNomer + 1;\n\t\t\t}\n\n\t\t\trequest.page_settings = this.#pageSettings;\n\t\t\trequest.sessid = BX.bitrix_sessid();\n\n\t\t\tAjax({\n\t\t\t\tmethod: 'POST',\n\t\t\t\tprocessData: true,\n\t\t\t\turl: this.#url,\n\t\t\t\tdata: request,\n\t\t\t\tonsuccess: (response: string) => {\n\t\t\t\t\tconst data = JSON.parse(response);\n\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tmessages: data.data,\n\t\t\t\t\t\tpageSettings: data.page_settings,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonfailure: (error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#renderMessages(): void\n\t{\n\t\tthis.#messages.forEach((message, index) => {\n\t\t\tDom.append(\n\t\t\t\tthis.#renderMessageElement(message, index === 0),\n\t\t\t\tthis.#getMessagesListContainer(),\n\t\t\t);\n\t\t});\n\t}\n\n\t#renderMessageElement(messageData: ImportantMessagesWidgetMessage, isActive: boolean): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sidebar-imp-mess ${isActive ? '--active' : ''}\" data-message-id=\"${messageData.id}\">\n\t\t\t\t<a href=\"${messageData.post_url}\" class=\"sidebar-imp-mess-wrap\">\n\t\t\t\t\t<div class=\"sidebar-imp-mess-avatar-block\">\n\t\t\t\t\t\t<div class=\"sidebar-imp-mess-author-avatar ui-icon ui-icon-common-user\"><i ${messageData.author_avatar}></i></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"sidebar-imp-mess-info\">\n\t\t\t\t\t\t<div class=\"sidebar-imp-mess-title\">${messageData.author_name}</div>\n\t\t\t\t\t\t<div class=\"sidebar-imp-mess-text\">${messageData.post_text}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tasync #handleClickOnNextBtn(): Promise<void>\n\t{\n\t\tif (!this.#hasNextMessage() && this.#needLoadNewMessages())\n\t\t{\n\t\t\tthis.#showLoader();\n\t\t\tawait this.#loadNewMessages();\n\t\t\tthis.#hideLoader();\n\t\t}\n\n\t\treturn this.#showNextMessage()\n\t\t\t.then(() => {\n\t\t\t\tthis.updateNavigation();\n\t\t\t})\n\t\t\t.catch(() => {})\n\t\t;\n\t}\n\n\tasync #showNextMessage(): Promise<void>\n\t{\n\t\tif (!this.#hasNextMessage())\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst activeMessage = this.#getMessagesListContainer().querySelector('.sidebar-imp-mess.--active');\n\t\t\tconst nextMessage = activeMessage.nextElementSibling || this.#getMessagesListContainer().firstElementChild;\n\n\t\t\tthis.#activeMessageIndex = this.#getNextMessageIndex();\n\n\t\t\tDom.addClass(activeMessage, '--slide-out-left');\n\t\t\tDom.addClass(nextMessage, '--active');\n\t\t\tDom.addClass(nextMessage, '--slide-in-right');\n\t\t\tEvent.bindOnce(activeMessage, 'animationend', () => {\n\t\t\t\tDom.removeClass(activeMessage, '--active');\n\t\t\t\tDom.removeClass(activeMessage, '--slide-out-left');\n\t\t\t\tDom.removeClass(nextMessage, '--slide-in-right');\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\t#showPrevMessage(): Promise<void>\n\t{\n\t\tif (!this.#hasPrevMessage())\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst activeMessage = this.#getMessagesListContainer().querySelector('.sidebar-imp-mess.--active');\n\t\t\tconst prevMessage = activeMessage.previousElementSibling || this.#getMessagesListContainer().lastElementChild;\n\n\t\t\tthis.#activeMessageIndex = this.#getPrevMessageIndex();\n\n\t\t\tDom.addClass(activeMessage, '--slide-out-right');\n\t\t\tDom.addClass(prevMessage, '--active');\n\t\t\tDom.addClass(prevMessage, '--slide-in-left');\n\t\t\tEvent.bindOnce(activeMessage, 'animationend', () => {\n\t\t\t\tDom.removeClass(activeMessage, '--active');\n\t\t\t\tDom.removeClass(activeMessage, '--slide-out-right');\n\t\t\t\tDom.removeClass(prevMessage, '--slide-in-left');\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tasync #readMessage(messageId: string): void\n\t{\n\t\tconst data = this.#getMessageById(messageId);\n\t\tconst options = [];\n\t\tfor (const option of this.#options)\n\t\t{\n\t\t\toptions.push({\n\t\t\t\tpost_id: data.id,\n\t\t\t\tname: option.name,\n\t\t\t\tvalue: option.value,\n\t\t\t});\n\t\t}\n\n\t\tlet request = this.#postInfo;\n\t\trequest.options = options;\n\t\trequest.page_settings = this.#pageSettings;\n\t\trequest.sessid = BX.bitrix_sessid();\n\t\trequest = Ajax.prepareData(request);\n\n\t\tthis.#showLoader();\n\n\t\tif (!this.#hasNextMessage() && this.#needLoadNewMessages())\n\t\t{\n\t\t\tawait this.#loadNewMessages();\n\t\t}\n\n\t\tAjax({\n\t\t\tmethod: 'GET',\n\t\t\turl: this.#url + (this.#url.includes('?') ? '&' : '?') + request,\n\t\t\tonsuccess: (response) => {\n\t\t\t\tconst data = JSON.parse(response);\n\t\t\t\tthis.#removeMessageFromList(messageId, data.page_settings);\n\t\t\t\tthis.#hideLoader();\n\t\t\t},\n\t\t\tonfailure: () => {\n\t\t\t\tthis.#hideLoader();\n\t\t\t},\n\t\t});\n\t}\n\n\t#setPageSettings(pageSettings: ImportantMessagesWidgetPageSettings): void\n\t{\n\t\tthis.#pageSettings = pageSettings;\n\t}\n\n\t#hasNextMessage(): boolean\n\t{\n\t\treturn this.#activeMessageIndex + 1 <= this.#messages.length - 1;\n\t}\n\n\t#getNextMessageIndex(): number\n\t{\n\t\treturn this.#activeMessageIndex + 1 > this.#messages.length - 1 ? 0 : this.#activeMessageIndex + 1;\n\t}\n\n\t#hasPrevMessage(): boolean\n\t{\n\t\treturn this.#activeMessageIndex - 1 >= 0;\n\t}\n\n\t#getPrevMessageIndex(): number\n\t{\n\t\treturn this.#activeMessageIndex - 1 < 0 ? this.#messages.length - 1 : this.#activeMessageIndex - 1;\n\t}\n\n\t#removeMessageFromList(messageId: string, pageSettings = null): void\n\t{\n\t\tconst finalize = () => {\n\t\t\tconst activeMessage = this.getActiveMessage();\n\t\t\tDom.remove(messageElement);\n\t\t\tthis.#messages = this.#messages.filter((message) => message.id !== messageId);\n\n\t\t\tthis.#activeMessageIndex = Math.max(\n\t\t\t\t0,\n\t\t\t\tthis.#messages.findIndex((message) => message.id === activeMessage.id),\n\t\t\t);\n\n\t\t\tif (pageSettings === null)\n\t\t\t{\n\t\t\t\tthis.#setPageSettings({\n\t\t\t\t\t...this.#pageSettings,\n\t\t\t\t\tNavRecordCount: Math.max(0, this.#pageSettings.NavRecordCount - 1),\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#setPageSettings(pageSettings);\n\t\t\t}\n\n\t\t\tthis.updateNavigation();\n\t\t\tif (this.#messages.length === 0)\n\t\t\t{\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t};\n\n\t\tconst messageElement = this.#getMessagesListContainer().querySelector(`[data-message-id=\"${messageId}\"]`);\n\t\tconst activeMessageElement = this.#getActiveMessageElement();\n\t\tif (messageElement === activeMessageElement)\n\t\t{\n\t\t\tif (this.#hasNextMessage())\n\t\t\t{\n\t\t\t\tthis.#showNextMessage().then(finalize).catch(() => {});\n\t\t\t}\n\t\t\telse if (this.#hasPrevMessage())\n\t\t\t{\n\t\t\t\tthis.#showPrevMessage().then(finalize).catch(() => {});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfinalize();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfinalize();\n\t\t}\n\t}\n\n\t#getActiveMessageElement(): HTMLElement\n\t{\n\t\treturn this.#getMessagesListContainer().querySelector('.--active');\n\t}\n\n\t#getMessageById(messageId: string): ?ImportantMessagesWidgetMessage\n\t{\n\t\treturn this.#messages.find((message) => message.id === messageId);\n\t}\n\n\t#getMessagesListContainer(): HTMLElement\n\t{\n\t\treturn document.getElementById('sidebar-imp-mess-list');\n\t}\n\n\t#getReadMessageButton(): HTMLButtonElement\n\t{\n\t\treturn document.getElementById('sidebar-imp-mess-read-button');\n\t}\n\n\t#getWidgetContainer(): HTMLElement\n\t{\n\t\treturn document.getElementById(this.#widgetContainerId);\n\t}\n\n\t#updateCurrentMessageNumber(): void\n\t{\n\t\tconst currentMessageNumberContainer = document.getElementById('sidebar-imp-mess-current-mess-number');\n\n\t\tcurrentMessageNumberContainer.textContent = this.#activeMessageIndex + 1;\n\t}\n\n\t#updateTotalMessagesNumber(): void\n\t{\n\t\tconst totalMessagesNumberContainer = this.#getTotalMessagesNumberContainer();\n\t\ttotalMessagesNumberContainer.textContent = this.#pageSettings.NavRecordCount;\n\t}\n\n\t#getTotalMessagesNumberContainer(): HTMLElement\n\t{\n\t\treturn document.getElementById('sidebar-imp-mess-total');\n\t}\n\n\t#getActiveMessageIndex(): number\n\t{\n\t\treturn [...this.#getMessagesListContainer().children]\n\t\t\t.indexOf(this.#getMessagesListContainer().querySelector('.--active'))\n\t\t;\n\t}\n\n\tgetActiveMessage(): ImportantMessagesWidgetMessage | null\n\t{\n\t\treturn this.#messages[this.#getActiveMessageIndex()] || null;\n\t}\n\n\t#getPrevMessageButton(): HTMLButtonElement\n\t{\n\t\treturn document.getElementById('sidebar-imp-mess-prev');\n\t}\n\n\t#getNextMessageButton(): HTMLButtonElement\n\t{\n\t\treturn document.getElementById('sidebar-imp-mess-next');\n\t}\n\n\t#showLoader(): void\n\t{\n\t\tthis.#loaderOverlay = Tag.render`\n\t\t\t<div class=\"sidebar-widget-content-overlay\"></div>\n\t\t`;\n\n\t\tDom.style(this.#loaderOverlay, {\n\t\t\tposition: 'absolute',\n\t\t\ttop: 0,\n\t\t\tleft: 0,\n\t\t\twidth: '100%',\n\t\t\theight: '100%',\n\t\t\tbackground: 'rgba(255, 255, 255, 0.7)',\n\t\t});\n\n\t\tDom.append(this.#loaderOverlay, this.#getWidgetContainer());\n\n\t\tif (!this.#loader)\n\t\t{\n\t\t\tthis.#loader = new Loader({\n\t\t\t\tsize: 60,\n\t\t\t\ttarget: this.#loaderOverlay,\n\t\t\t\tcolor: '#0154C8',\n\t\t\t});\n\t\t}\n\n\t\tthis.#loader.show();\n\t}\n\n\t#hideLoader(): void\n\t{\n\t\tthis.#loader?.hide();\n\t\tDom.remove(this.#loaderOverlay);\n\t}\n\n\tupdateNavigation(): void\n\t{\n\t\tif (this.#activeMessageIndex >= this.#pageSettings.NavRecordCount - 1)\n\t\t{\n\t\t\tthis.#disableNextButton();\n\t\t}\n\t\telse if (this.#pageSettings.NavRecordCount > 1)\n\t\t{\n\t\t\tthis.#enableNextButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#disableNextButton();\n\t\t}\n\n\t\tif (this.#activeMessageIndex === 0)\n\t\t{\n\t\t\tthis.#disablePrevButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#enablePrevButton();\n\t\t}\n\n\t\tthis.#updateCurrentMessageNumber();\n\t\tthis.#updateTotalMessagesNumber();\n\t}\n\n\t#enableNextButton()\n\t{\n\t\tthis.#getNextMessageButton().removeAttribute('disabled');\n\t}\n\n\t#disableNextButton()\n\t{\n\t\tthis.#getNextMessageButton().setAttribute('disabled', true);\n\t}\n\n\t#enablePrevButton()\n\t{\n\t\tthis.#getPrevMessageButton().removeAttribute('disabled');\n\t}\n\n\t#disablePrevButton()\n\t{\n\t\tthis.#getPrevMessageButton().setAttribute('disabled', true);\n\t}\n}\n"],"names":["ImportantMessagesWidget","constructor","options","widgetContainerId","messages","postInfo","url","pageSettings","AJAX_POST","init","Event","bind","then","updateNavigation","catch","activeMessage","getActiveMessage","id","EventEmitter","subscribe","event","messageId","getData","loadNewMessages","Runtime","debounce","show","length","command","params","getCompatData","Loc","getMessage","message","element","querySelector","Dom","addClass","removeClass","hide","bindOnce","NavRecordCount","bDescPageNumbering","NavPageNomer","data","push","append","Promise","resolve","reject","request","iNumPage","page_settings","sessid","BX","bitrix_sessid","Ajax","method","processData","onsuccess","response","JSON","parse","onfailure","error","forEach","index","messageData","isActive","Tag","render","post_url","author_avatar","author_name","post_text","nextMessage","nextElementSibling","firstElementChild","prevMessage","previousElementSibling","lastElementChild","option","post_id","name","value","prepareData","includes","finalize","remove","messageElement","filter","Math","max","findIndex","activeMessageElement","find","document","getElementById","currentMessageNumberContainer","textContent","totalMessagesNumberContainer","children","indexOf","style","position","top","left","width","height","background","Loader","size","target","color","removeAttribute","setAttribute"],"mappings":"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"}